#include <16F877a.h>
#device ADC = 10
#use delay(crystal = 20000000)
#FUSES NOWDT, NOBROWNOUT, NOLVP, HS

#include <lcd_c.c>
#include <kbd4x4_b.c>
#include <getNum16.c>

#use STANDARD_IO(D)

#define PWM_SERVO PIN_D0 

int8 grados;

void mover_servo(int8 grados){
   // Calcular tiempo en alto (1m a 2m)
   int16 t_alto = (float)grados * 5.555555 + 1000.0;
   
   // Periodo de 20ms
   int16 t_bajo = 20000.0 - t_alto;
   
   // Ejecutar el pulso 10 veces
   for(int8 i = 0; i < 10; i++)
   {
     output_high(PWM_SERVO);
     delay_us(t_alto);
     output_low(PWM_SERVO);
     delay_us(t_bajo);
   }
}

void PreguntarDato(){//preguntar al usuario dato a ingresar
int1 condicion;
    do{
         printf(lcd_putc,"\fIGRESA GRADOS: ");
         grados = get_num_lcd(1,2);
         condicion = (grados<180 && grados>0);
         if(condicion == 0)
         {
            printf(lcd_putc,"\fNOT VALID");
            delay_ms(1000);
         }
      }while(condicion == 0);
}

void main()
{
   // Inicializar pines
   lcd_init();
   kbd_init();
   
   output_low(PWM_SERVO);

   while (TRUE)
    {
      PreguntarDato();
      mover_servo(grados); // Mover el servo a 15 grados
      delay_ms(1000);
    }
}
